# 需求文档

## 简介

本规范定义了Amazon卖家中心克隆项目的综合多店铺管理系统。该系统集成了多店铺CRUD操作、国际化、实时数据同步和完整数据隔离功能。它将多个相关规范的功能整合到一个统一的系统中，支持店铺管理、货币切换、语言本地化以及管理后台与前端界面之间的无缝数据同步。

## 术语表

- **店铺**: 具有独立数据的不同业务实体（产品、销售、订单等）
- **市场**: 地理/区域性Amazon市场（美国、日本、英国、德国、欧洲）
- **管理界面**: React + Ant Design管理界面（端口3002）
- **前端**: React + TypeScript卖家界面（端口3000）
- **后端API**: Node.js + Express API服务器（端口3001）
- **店铺上下文**: 当前选择的店铺，决定数据范围
- **数据隔离**: 不同店铺之间数据的完全分离
- **实时同步**: 管理后台与前端系统之间的即时数据同步
- **本地化**: 针对特定语言和地区的内容适配
- **货币符号**: 基于市场选择显示的货币符号
- **WebSocket连接**: 管理后台与前端之间的实时通信通道

## 需求

### 需求1：多店铺数据管理和隔离

**用户故事：** 作为系统管理员，我希望管理多个店铺并实现完整的数据隔离，以便每个店铺的数据保持独立和安全。

#### 验收标准

1. 当管理员在管理界面中创建新店铺时，后端API应为所有店铺特定实体创建隔离的数据容器
2. 当从后端API查询数据时，系统应根据当前店铺上下文过滤所有结果
3. 当切换店铺时，前端应仅显示属于所选店铺的数据
4. 管理界面应提供带验证的店铺管理CRUD操作
5. 当删除店铺时，后端API应删除所有关联数据，同时保留其他店铺的数据
6. 后端API应通过API端点防止跨店铺数据访问
7. 系统应维护店铺与其关联数据之间的引用完整性

### 需求2：店铺选择和上下文管理

**用户故事：** 作为卖家，我希望能够无缝切换不同的店铺，以便从一个界面管理多个业务。

#### 验收标准

1. 当用户访问前端时，系统应从后端API加载可用店铺
2. 当用户选择不同店铺时，前端应更新店铺上下文并刷新所有显示的数据
3. 店铺选择器应显示店铺名称和关联的市场信息
4. 当没有可用店铺时，前端应显示适当的消息和指导
5. 系统应在用户会话中持久化所选店铺
6. 系统应在管理界面和前端都提供店铺选择下拉菜单
7. 系统应在允许上下文切换之前验证店铺访问权限

### 需求3：市场集成和货币管理

**用户故事：** 作为卖家，我希望每个店铺都与特定市场关联并具有正确的货币格式，以便财务信息清晰准确。

#### 验收标准

1. 当创建店铺时，管理界面应要求从可用选项中选择市场
2. 当选择店铺时，前端应自动应用关联的市场设置
3. 市场选择器应与店铺配置的市场同步
4. 当更改店铺的市场时，系统应更新货币符号和区域格式
5. 系统应支持市场：美国、日本、英国、德国、欧洲
6. 系统应支持货币符号：$（美元）、¥（日元）、£（英镑）、€（欧元）
7. 货币格式应在所有页面和组件中保持一致

### 需求4：全面国际化

**用户故事：** 作为用户，我希望能够完全切换界面语言，以便所有文本都以我的首选语言显示，不混合语言。

#### 验收标准

1. 当用户更改语言时，前端应立即更新所有界面文本
2. 系统应消除所有混合语言内容（中英文组合）
3. 当显示数据时，系统应根据所选区域设置格式化数字、日期和货币
4. 语言偏好应在浏览器会话中持久化
5. 系统应支持英语（en-US）和简体中文（zh-CN）语言
6. 系统应国际化所有仪表板组件、库存管理、订单管理、业务报告和设置页面
7. 系统应提供一致的翻译键和参数支持

### 需求5：实时数据同步基础设施

**用户故事：** 作为内容管理员，我希望管理界面中的数据更改能立即显示在前端，以便实时查看修改效果。

#### 验收标准

1. 系统应在管理界面和前端之间建立WebSocket连接
2. 系统应在任何管理界面表单修改数据时触发同步事件
3. 前端应自动刷新受影响的数据，无需手动页面重新加载
4. 系统应保持连接稳定性，在连接丢失时自动重连
5. 系统应在同步操作进行时在管理后台和前端提供视觉指示器
6. 系统应优雅地处理并发修改，具有冲突解决机制
7. 系统应在WebSocket连接丢失时提供优雅降级

### 需求6：全面数据同步覆盖

**用户故事：** 作为系统管理员，我希望所有可编辑数据字段都在管理后台和前端之间同步，以便系统保持完整的数据一致性。

#### 验收标准

1. 系统应同步店铺信息数据（名称、市场、设置、联系信息）
2. 系统应同步全局快照指标（销售、订单、消息、反馈、付款）
3. 系统应同步产品数据（标题、价格、库存、图片、状态）
4. 系统应同步销售数据（每日销售、快照、分析）
5. 系统应同步账户健康指标（绩效指标、合规状态）
6. 系统应同步法律实体信息（业务详情、地址）
7. 系统应同步客户之声数据（评论、满意度指标）

### 需求7：图片上传和媒体管理

**用户故事：** 作为内容管理员，我希望能够上传和管理产品图片并立即同步，以便视觉内容更改能实时反映。

#### 验收标准

1. 系统应在管理界面中提供支持拖放的图片上传功能
2. 系统应在成功上传后立即同步产品图片上传
3. 系统应处理图片替换和删除，并进行适当清理
4. 系统应验证图片格式（JPEG、PNG、GIF、WebP）和大小（最大5MB）
5. 系统应提供图片优化和缓存以提高性能
6. 系统应在所有系统中保持图片URL一致性
7. 系统应在同步失败时提供备用图片

### 需求8：分页和数据加载同步

**用户故事：** 作为查看大型数据集的用户，我希望分页在同步数据中正确工作，以便在两个界面中高效导航数据。

#### 验收标准

1. 系统应在管理后台和前端之间保持同步的分页状态
2. 系统应在添加或删除数据时更新分页控件
3. 系统应在同一页面修改数据时保持当前页面位置
4. 系统应在总项目数更改时正确处理页面导航
5. 系统应在分页数据获取期间提供加载指示器
6. 系统应实现高效的数据加载和适当的缓存策略
7. 系统应支持可配置的页面大小和同步设置

### 需求9：性能优化和缓存

**用户故事：** 作为处理大型数据集的用户，我希望数据加载快速且同步高效，以便不影响我的工作效率。

#### 验收标准

1. 系统应实现增量数据更新而不是完整数据替换
2. 系统应为WebSocket消息传输使用数据压缩
3. 系统应实现客户端缓存和适当的缓存失效
4. 系统应批处理多个快速更改以减少同步频率
5. 系统应优化数据库查询以防止店铺过滤数据的N+1问题
6. 系统应为大型产品目录实现懒加载
7. 系统应支持至少100个并发店铺而不影响性能

### 需求10：错误处理和恢复

**用户故事：** 作为系统用户，我希望在同步和店铺操作期间有强大的错误处理，以便临时故障不会中断我的工作流程。

#### 验收标准

1. 系统应为失败的同步操作实现自动重试机制
2. 系统应在同步失败时显示清晰的错误消息
3. 系统应在自动同步失败时提供手动刷新选项
4. 系统应在部分同步失败期间保持数据完整性
5. 系统应在保存到后端之前验证所有数据输入
6. 系统应优雅地处理API连接失败
7. 系统应记录详细的错误信息以便故障排除

### 需求11：安全和访问控制

**用户故事：** 作为安全管理员，我希望多店铺操作和同步通道安全，以便敏感数据得到保护。

#### 验收标准

1. 系统应为生产环境实现安全WebSocket连接（WSS）
2. 系统应在允许数据同步之前验证用户权限
3. 系统应在传输过程中加密敏感数据
4. 系统应实现速率限制以防止同步滥用
5. 系统应审计所有同步操作并记录用户归属
6. 系统应在同步期间验证数据完整性
7. 系统应为同步操作实现基于会话的访问控制

### 需求12：红色标记数据字段实现

**用户故事：** 作为开发人员，我希望识别并实现参考图像中标记为红色的所有数据字段的同步，以便系统覆盖所有必需的可编辑区域。

#### 验收标准

1. 系统应分析.kiro/specs/images目录中的所有参考图像
2. 系统应识别所有红色标记区域和相应的数据字段
3. 系统应为所有红色标记字段实现管理界面表单
4. 系统应确保前端正确显示所有红色标记数据
5. 系统应验证所有红色标记字段在管理后台中可编辑
6. 系统应测试从管理后台修改到前端显示的数据流
7. 系统应记录红色标记字段与数据模型之间的映射

### 需求13：测试和质量保证

**用户故事：** 作为质量保证工程师，我希望对多店铺系统进行全面测试，以便确保数据一致性和可靠性。

#### 验收标准

1. 系统应提供WebSocket连接建立的自动化测试
2. 系统应包括所有实体类型的数据同步测试
3. 系统应测试店铺上下文切换和数据隔离
4. 系统应在各种场景下验证分页同步
5. 系统应测试错误处理和恢复机制
6. 系统应包括大型数据集同步的性能测试
7. 系统应为关键功能保持80%以上的测试覆盖率

### 需求14：监控和配置

**用户故事：** 作为系统管理员，我希望有监控功能和可配置的同步设置，以便确保系统健康并优化性能。

#### 验收标准

1. 系统应提供同步操作的实时监控仪表板
2. 系统应跟踪同步成功率和失败模式
3. 系统应监控WebSocket连接健康和稳定性
4. 系统应为不同数据类型提供可配置的同步间隔
5. 系统应允许启用/禁用特定数据类别的同步
6. 系统应支持不同的同步策略（即时、批处理、计划）
7. 系统应提供无需系统重启的运行时配置更新