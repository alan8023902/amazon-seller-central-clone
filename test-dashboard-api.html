<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard API Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .success { color: green; }
        .error { color: red; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Dashboard API Test</h1>
    
    <div class="test-section">
        <h2>1. Test Store API</h2>
        <button onclick="testStores()">Test /api/stores</button>
        <div id="stores-result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Test Dashboard Snapshot API</h2>
        <button onclick="testDashboardSnapshot()">Test Dashboard Snapshot</button>
        <div id="dashboard-result"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Test Frontend API Service</h2>
        <button onclick="testFrontendAPI()">Test Frontend storeApi.getCurrentStore()</button>
        <div id="frontend-result"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3002/api';
        
        async function testStores() {
            const resultDiv = document.getElementById('stores-result');
            try {
                const response = await fetch(`${API_BASE}/stores`);
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">✅ Success</div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">❌ Error: ${response.status}</div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">❌ Network Error: ${error.message}</div>
                `;
            }
        }
        
        async function testDashboardSnapshot() {
            const resultDiv = document.getElementById('dashboard-result');
            try {
                // First get stores to get a store ID
                const storesResponse = await fetch(`${API_BASE}/stores`);
                const storesData = await storesResponse.json();
                
                if (!storesData.success || storesData.data.length === 0) {
                    resultDiv.innerHTML = '<div class="error">❌ No stores found</div>';
                    return;
                }
                
                const storeId = storesData.data[0].id;
                const response = await fetch(`${API_BASE}/dashboard/snapshot/${storeId}`);
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">✅ Success (Store: ${storesData.data[0].name})</div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">❌ Error: ${response.status}</div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">❌ Network Error: ${error.message}</div>
                `;
            }
        }
        
        async function testFrontendAPI() {
            const resultDiv = document.getElementById('frontend-result');
            try {
                // Simulate the frontend storeApi service
                const storeApiService = {
                    async getStores() {
                        const response = await fetch(`${API_BASE}/stores`);
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        const result = await response.json();
                        return result.data || [];
                    },
                    
                    async getCurrentStore() {
                        const stores = await this.getStores();
                        return stores.length > 0 ? stores[0] : null;
                    }
                };
                
                const currentStore = await storeApiService.getCurrentStore();
                
                if (currentStore) {
                    resultDiv.innerHTML = `
                        <div class="success">✅ Success</div>
                        <pre>${JSON.stringify(currentStore, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">❌ No current store found</div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">❌ Error: ${error.message}</div>
                `;
            }
        }
        
        // Auto-run tests on page load
        window.onload = function() {
            testStores();
            setTimeout(testDashboardSnapshot, 1000);
            setTimeout(testFrontendAPI, 2000);
        };
    </script>
</body>
</html>