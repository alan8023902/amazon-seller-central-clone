# åç«¯ç®¡ç†ç•Œé¢APIè¿æ¥é—®é¢˜è§£å†³æ–¹æ¡ˆ

## é—®é¢˜æè¿°
åç«¯ç®¡ç†ç•Œé¢å¯åŠ¨åæŠ¥é”™ï¼š"APIè¿æ¥é”™è¯¯æ— æ³•è¿æ¥åˆ°åç«¯APIæœåŠ¡å™¨ã€‚è¯·ç¡®ä¿åç«¯æœåŠ¡å™¨æ­£åœ¨è¿è¡Œåœ¨ http://localhost:3001"

## æ ¹æœ¬åŸå› åˆ†æ

### 1. é”€å”®APIç«¯ç‚¹ç¼ºå¤± âŒ â†’ âœ… å·²ä¿®å¤
- **é—®é¢˜**: åç«¯ç®¡ç†ç•Œé¢è¯·æ±‚ `/api/sales?store_id=1` ä½†è¯¥ç«¯ç‚¹ä¸å­˜åœ¨
- **ç°è±¡**: åç«¯æ—¥å¿—æ˜¾ç¤º `ğŸ“¤ ğŸ”´ 404 GET /?store_id=1`
- **è§£å†³**: åœ¨ `backend/src/routes/sales.ts` ä¸­æ·»åŠ äº†æ ¹è·¯ç”±å¤„ç†

### 2. æœåŠ¡å™¨é…ç½®æ£€æŸ¥ âœ… æ­£å¸¸
- **åç«¯æœåŠ¡å™¨**: æ­£åœ¨è¿è¡Œåœ¨ http://localhost:3001 âœ…
- **ç®¡ç†ç•Œé¢**: æ­£åœ¨è¿è¡Œåœ¨ http://localhost:3002 âœ…
- **CORSé…ç½®**: å·²æ­£ç¡®é…ç½®åŒ…å«3002ç«¯å£ âœ…

### 3. APIé…ç½®æ£€æŸ¥ âœ… æ­£å¸¸
- **BASE_URL**: `http://localhost:3001` âœ…
- **ç«¯ç‚¹é…ç½®**: æ­£ç¡®é…ç½®æ‰€æœ‰APIç«¯ç‚¹ âœ…

## è§£å†³æ­¥éª¤

### æ­¥éª¤1: ä¿®å¤é”€å”®APIç«¯ç‚¹
åœ¨ `backend/src/routes/sales.ts` ä¸­æ·»åŠ äº†æ ¹è·¯ç”±å¤„ç†ï¼š

```typescript
// GET /api/sales?store_id=:storeId - Get sales data by store (for admin compatibility)
router.get('/', asyncHandler(async (req, res) => {
  const { store_id } = req.query;
  
  if (!store_id) {
    throw createError('store_id query parameter is required', 400);
  }
  
  // å¤„ç†é”€å”®æ•°æ®è¯·æ±‚
  let snapshots = await dataService.findByStoreId<SalesSnapshot>('sales_snapshots', store_id as string);
  // ... å…¶ä½™é€»è¾‘
}));
```

### æ­¥éª¤2: éªŒè¯ä¿®å¤
1. åç«¯æœåŠ¡å™¨è‡ªåŠ¨é‡å¯ âœ…
2. é”€å”®APIç«¯ç‚¹ç°åœ¨å¯ç”¨ âœ…
3. 404é”™è¯¯åº”è¯¥æ¶ˆå¤± âœ…

## æµ‹è¯•éªŒè¯

### æ‰‹åŠ¨æµ‹è¯•APIç«¯ç‚¹
```bash
# æµ‹è¯•é”€å”®API
curl "http://localhost:3001/api/sales?store_id=store-us-main"

# æµ‹è¯•åº—é“ºAPI
curl "http://localhost:3001/api/stores"

# æµ‹è¯•Dashboard API
curl "http://localhost:3001/api/dashboard/snapshot/store-us-main"
```

### æµè§ˆå™¨æµ‹è¯•
æ‰“å¼€ä»¥ä¸‹æµ‹è¯•é¡µé¢éªŒè¯ä¿®å¤ï¼š
- `test-admin-api-connection.html`
- `test-sales-api-fix.html`

## é¢„æœŸç»“æœ

ä¿®å¤åï¼Œåç«¯ç®¡ç†ç•Œé¢åº”è¯¥èƒ½å¤Ÿï¼š
1. âœ… æˆåŠŸè¿æ¥åˆ°åç«¯APIæœåŠ¡å™¨
2. âœ… åŠ è½½åº—é“ºåˆ—è¡¨
3. âœ… è·å–é”€å”®æ•°æ®
4. âœ… æ˜¾ç¤ºDashboardé…ç½®
5. âœ… ä¸å†æ˜¾ç¤º"APIè¿æ¥é”™è¯¯"

## å…¶ä»–å¯èƒ½çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼š

1. **æ£€æŸ¥é˜²ç«å¢™è®¾ç½®**
   ```bash
   # Windowsé˜²ç«å¢™å¯èƒ½é˜»æ­¢3001ç«¯å£
   netstat -an | findstr :3001
   ```

2. **æ£€æŸ¥ç«¯å£å ç”¨**
   ```bash
   netstat -ano | findstr :3001
   netstat -ano | findstr :3002
   ```

3. **æ¸…é™¤æµè§ˆå™¨ç¼“å­˜**
   - æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·
   - å³é”®åˆ·æ–°æŒ‰é’®ï¼Œé€‰æ‹©"æ¸…ç©ºç¼“å­˜å¹¶ç¡¬æ€§é‡æ–°åŠ è½½"

4. **æ£€æŸ¥ç½‘ç»œè¿æ¥**
   ```bash
   ping localhost
   telnet localhost 3001
   ```

5. **é‡å¯æ‰€æœ‰æœåŠ¡**
   ```bash
   # åœæ­¢æ‰€æœ‰æœåŠ¡
   Ctrl+C (åœ¨å„ä¸ªç»ˆç«¯)
   
   # é‡æ–°å¯åŠ¨
   cd backend && npm run dev
   cd backend-admin && npm run dev
   cd frontend && npm run dev
   ```

## ç›‘æ§å’Œæ—¥å¿—

### åç«¯æ—¥å¿—ç›‘æ§
æŸ¥çœ‹åç«¯æ—¥å¿—ç¡®è®¤APIè¯·æ±‚æ­£å¸¸ï¼š
```
ğŸ“¥ GET /api/sales?store_id=store-us-main - 2026-01-21T12:xx:xx.xxxZ
ğŸ“¤ ğŸŸ¢ 200 GET /?store_id=store-us-main - xms
```

### æµè§ˆå™¨å¼€å‘è€…å·¥å…·
1. æ‰“å¼€åç«¯ç®¡ç†ç•Œé¢ (http://localhost:3002)
2. æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·
3. æŸ¥çœ‹ Network æ ‡ç­¾é¡µ
4. ç¡®è®¤APIè¯·æ±‚è¿”å›200çŠ¶æ€ç 

## æ€»ç»“

ä¸»è¦é—®é¢˜æ˜¯é”€å”®APIç¼ºå°‘æ ¹è·¯ç”±å¤„ç†ï¼Œå¯¼è‡´åç«¯ç®¡ç†ç•Œé¢æ— æ³•è·å–é”€å”®æ•°æ®ã€‚é€šè¿‡æ·»åŠ æ ¹è·¯ç”±å¤„ç†ï¼Œé—®é¢˜å·²å¾—åˆ°è§£å†³ã€‚åç«¯ç®¡ç†ç•Œé¢ç°åœ¨åº”è¯¥èƒ½å¤Ÿæ­£å¸¸è¿æ¥åˆ°åç«¯APIæœåŠ¡å™¨å¹¶è·å–æ‰€éœ€æ•°æ®ã€‚